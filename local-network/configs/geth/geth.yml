services:
  bootnode:
    image: ethereum/client-go:alltools-stable
    volumes:
      - ./run-bootnode.sh:/tmp/run.sh:ro
      - ../ec-common/p2p-key-bootnode.hex:/bootnode.key:ro
      - ../../logs/ec-bootnode:/root/logs
    command: /tmp/run.sh
  geth:
    image: ethereum/client-go:stable
    stop_grace_period: 10s
    entrypoint: /tmp/run.sh
    volumes:
      - ../ec-common/genesis.json:/tmp/genesis.json:ro
      - ./run-node.sh:/tmp/run.sh
    env_file:
      - ../ec-common/peers.env
    logging:
      driver: none
    healthcheck:
      test: 'wget -qO /dev/null --header "content-type: application/json" --post-data {\"jsonrpc\":\"2.0\",\"method\":\"eth_blockNumber\",\"params\":[],\"id\":1} http://127.0.0.1:8545'
      interval: 5s
      timeout: 1s
      retries: 10
